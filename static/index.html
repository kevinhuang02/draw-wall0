<!doctype html>
<html lang="zh-TW">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>å¤šäººç•«ç•«åŒæ­¥ + Matter.js</title>
<style>
  body { margin:0; background:#222; color:#fff; font-family:sans-serif; }
  #toolbar { display:flex; gap:10px; padding:10px; background:#333; align-items:center; justify-content: space-between; }
  #left-toolbar { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
  canvas {
    display:block;
    background:#fff;
    touch-action:none;
    margin:0 auto;
    position:absolute;
    left:0; right:0;
  }
  #matterCanvas { pointer-events:none; }
  button,input { padding:6px; border-radius:6px; border:none; }
</style>
</head>
<body>

<div id="toolbar">
  <div id="left-toolbar">
    <button id="pen">âœï¸</button>
    <button id="eraser">ğŸ§½</button>
    <input type="color" id="colorPicker" value="#000000">
    <input type="range" id="sizePicker" min="2" max="40" value="5">
    <button id="clear">ğŸ—‘ï¸</button>
    <button id="save">ğŸ’¾</button>
    <button id="selectBtn">ğŸ“¦ æ¡†é¸</button>
  </div>
</div>

<canvas id="drawCanvas"></canvas>
<canvas id="selectCanvas"></canvas>
<canvas id="matterCanvas"></canvas>

<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.20.0/matter.min.js"></script>
<script>
// ===== åŸºæœ¬è¨­å®š =====
const VIRTUAL_WIDTH = 1920;
const VIRTUAL_HEIGHT = 1080;

const drawCanvas = document.getElementById("drawCanvas");
const selectCanvas = document.getElementById("selectCanvas");
const matterCanvas = document.getElementById("matterCanvas");

[drawCanvas, selectCanvas, matterCanvas].forEach(c=>{
  c.width = VIRTUAL_WIDTH;
  c.height = VIRTUAL_HEIGHT;
});

const ctx = drawCanvas.getContext("2d");
const sctx = selectCanvas.getContext("2d");

// ===== å·¥å…· =====
let mode="pen", drawing=false;
let color=colorPicker.value, size=sizePicker.value;
let lx,ly;

pen.onclick=()=>mode="pen";
eraser.onclick=()=>mode="eraser";
colorPicker.oninput=e=>color=e.target.value;
sizePicker.oninput=e=>size=e.target.value;

function pos(e){
  const r=drawCanvas.getBoundingClientRect();
  return {
    x:(e.clientX-r.left)*(VIRTUAL_WIDTH/r.width),
    y:(e.clientY-r.top)*(VIRTUAL_HEIGHT/r.height)
  };
}

// ===== ç•«ç•« =====
drawCanvas.onpointerdown=e=>{
  if(selectMode) return;
  drawing=true;
  const p=pos(e); lx=p.x; ly=p.y;
};
drawCanvas.onpointermove=e=>{
  if(!drawing||selectMode) return;
  const p=pos(e);
  ctx.strokeStyle=mode==="pen"?color:"#fff";
  ctx.lineWidth=size;
  ctx.lineCap="round";
  ctx.beginPath();
  ctx.moveTo(lx,ly); ctx.lineTo(p.x,p.y); ctx.stroke();
  lx=p.x; ly=p.y;
};
drawCanvas.onpointerup=()=>drawing=false;

clear.onclick=()=>ctx.clearRect(0,0,VIRTUAL_WIDTH,VIRTUAL_HEIGHT);
save.onclick=()=>{
  const a=document.createElement("a");
  a.download="canvas.png";
  a.href=drawCanvas.toDataURL();
  a.click();
};

// ===== Matter.js =====
const {Engine,Render,Runner,Bodies,World}=Matter;
const engine=Engine.create();

const render=Render.create({
  canvas:matterCanvas,
  engine,
  options:{
    width:VIRTUAL_WIDTH,
    height:VIRTUAL_HEIGHT,
    background:"transparent",
    wireframes:false
  }
});
Render.run(render);
Runner.run(Runner.create(),engine);

// åœ°æ¿
World.add(engine.world,
  Bodies.rectangle(
    VIRTUAL_WIDTH/2,
    VIRTUAL_HEIGHT+30,
    VIRTUAL_WIDTH,
    60,
    {isStatic:true}
  )
);

// ===== æ¡†é¸è½‰ç‰©ä»¶ =====
let selectMode=false;
let sx,sy,ex,ey;

selectBtn.onclick=()=>{
  selectMode=!selectMode;
  selectBtn.textContent=selectMode?"âœ… æ¡†é¸ä¸­":"ğŸ“¦ æ¡†é¸";
};

selectCanvas.onpointerdown=e=>{
  if(!selectMode) return;
  const p=pos(e);
  sx=p.x; sy=p.y;
};

selectCanvas.onpointermove=e=>{
  if(!selectMode||sx==null) return;
  const p=pos(e); ex=p.x; ey=p.y;
  sctx.clearRect(0,0,VIRTUAL_WIDTH,VIRTUAL_HEIGHT);
  sctx.strokeStyle="yellow";
  sctx.setLineDash([6,4]);
  sctx.strokeRect(sx,sy,ex-sx,ey-sy);
};

selectCanvas.onpointerup=()=>{
  if(!selectMode) return;
  sctx.clearRect(0,0,VIRTUAL_WIDTH,VIRTUAL_HEIGHT);
  createBody(sx,sy,ex,ey);
  sx=sy=null;
};

function createBody(x1,y1,x2,y2){
  const x=Math.min(x1,x2), y=Math.min(y1,y2);
  const w=Math.abs(x2-x1), h=Math.abs(y2-y1);
  if(w<10||h<10) return;

  const temp=document.createElement("canvas");
  temp.width=w; temp.height=h;
  temp.getContext("2d").drawImage(drawCanvas,x,y,w,h,0,0,w,h);

  const body=Bodies.rectangle(
    x+w/2,y+h/2,w,h,{
      restitution:0.6,
      render:{sprite:{texture:temp.toDataURL()}}
    }
  );
  World.add(engine.world,body);
}
</script>
</body>
</html>

















